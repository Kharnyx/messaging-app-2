const textarea=document.querySelectorAll("textarea"),messageInput=document.querySelector("#message-input"),sendMessageBtn=document.querySelector("#send-message-button"),chatContainer=document.querySelector("#chat-container"),chatBody=chatContainer.querySelector("#chat-body"),attachFileBtn=document.getElementById("attach-file-button"),attachFileInput=document.getElementById("attach-file-input");let attachedFiles=[],username="",conversationRecipientIds=[],messages=[],messagesToSend=[];function updateMessageStyles(){let e=document.getElementsByClassName("message-container"),t="0.25rem",n="1.25rem";for(let s=0;s<e.length;s++){let a=e[s],o=a.querySelector(".message"),l=a.classList.contains("from-me"),r=e[s-1],i=e[s+1],d=r&&r.classList.contains(l?"from-me":"from-others"),c=i&&i.classList.contains(l?"from-me":"from-others"),m=n,u=n;d&&(m=t),c&&(u=t),l?(o.style.borderTopRightRadius=m,o.style.borderBottomRightRadius=u):(o.style.borderTopLeftRadius=m,o.style.borderBottomLeftRadius=u),d||l||(o.style.borderTopLeftRadius=t),a.style.marginBottom=c||!i?"0.25rem":"2rem"}}messageInput.parentElement.addEventListener("click",()=>{}),messageInput.addEventListener("input",()=>{updateTextareaSize(messageInput)}),document.addEventListener("keydown",function(e){e.key.toLowerCase()}),attachFileBtn.addEventListener("click",()=>{attachFileInput.click()}),attachFileInput.addEventListener("change",()=>{if(attachFileInput.files.length>0){let e=attachFileInput.files;attachedFiles.push(e)}}),sendMessageBtn.addEventListener("click",sendMessage),updateMessageStyles();const userProfilePictures=document.querySelectorAll(".message-container .sender .profile-picture");for(let element of userProfilePictures){const e=element.querySelector("img");e.onerror=()=>{e.style.display="none"},""==e.src.trim()&&(e.style.display="none")}function sendMessage(){let e=messageInput.value.trim();if(e.length<1&&attachedFiles.length<1)return void console.warn("No message");messageInput.focus();let t=new Date,n=window.ProfanityFilter.clean(e),s={authToken:authToken,senderId:userId,senderName:username.trim()||userId,messageText:n,sentTime:t,recipientIds:conversationRecipientIds};connectedToServer?sendToServer("message",s):messagesToSend.push(s),messageInput.value="",updateTextareaSize(messageInput)}function createMessage(e,t){let n=e.senderId===userId,s=document.createElement("div");s.classList.add("message-container",n?"from-me":"from-others");let a=new Date(e.sentTime),o=e.sentTime?window.formatUTCTo12Hour(e.sentTime):"Unknown Time",l=document.createElement("div"),r=document.createElement("p");r.textContent=o,l.classList.add("sent-time"),l.appendChild(r);let i=a.getUTCMonth()+1,[d,c,m,u]=[a.getUTCDate(),a.toLocaleString("en-us",{weekday:"short",timeZone:"UTC"}),a.toLocaleString("en-us",{month:"short",timeZone:"UTC"}),a.getFullYear()];String(i).padStart(2,"0"),String(d).padStart(0,"0");let p=document.createElement("div");p.classList.add("sender");let h=document.createElement("div");h.classList.add("profile-picture");let g=document.createElement("img"),f=document.createElement("div");f.classList.add("sender-name"),f.textContent=e.senderName;let y=document.createElement("div");y.classList.add("files");let C=document.createElement("div");C.classList.add("message","ripple-button");let L=document.createElement("div");L.classList.add("label");let B=document.createElement("span");if(B.textContent=e.messageText,L.appendChild(B),C.appendChild(L),h.appendChild(g),p.appendChild(h),p.appendChild(f),s.appendChild(l),s.appendChild(p),s.appendChild(y),s.appendChild(C),!g.src){g.remove();let t=document.createElement("i");t.className="fa-solid fa-circle-user",t.id=`${e.senderName}-icon`,e.profileColour&&(t.style.color=e.profileColour),h.appendChild(t)}if(t){let n=Date.parse(t.sentTime);Date.parse(e.sentTime)-n<6e4&&l.classList.add("hide"),e.senderId===t.senderId&&p.remove(),isSameDay(a,t.sentTime)||(l.classList.add("new-day"),r.textContent=`${c}, ${d} ${m} at ${o}`)}else l.classList.add("new-day"),r.textContent=`${c}, ${d} ${m} at ${o}`;return s}function loadMessages(e){for(;chatBody.firstChild;)chatBody.firstChild.remove();let t=[];for(let n of e)arraysAreEqual(n.recipientIds,conversationRecipientIds)&&t.push(n);t.length<1&&(document.createElement("p").textContent="No messages");for(let e=0;e<t.length;e++){let n=e>0?createMessage(t[e],t[e-1]):createMessage(t[e]);n.querySelector(".new-day")&&chatBody.appendChild(n.querySelector(".new-day")),chatBody.appendChild(n)}updateMessageStyles(),chatContainer.scrollTop=chatContainer.scrollHeight-chatContainer.clientHeight}window.formatUTCTo12Hour=function(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})};const scrollBottomBtn=document.getElementById("scroll-bottom");function updateScrollBottom(){let e=chatContainer.scrollTop,t=chatContainer.scrollHeight;e+chatContainer.clientHeight>=t-2*rootFontSize?(scrollBottomBtn.classList.add("hide"),scrollBottomBtn.classList.contains("scrolling")&&scrollBottomBtn.classList.remove("scrolling")):scrollBottomBtn.classList.remove("hide")}chatContainer.addEventListener("scroll",updateScrollBottom),updateScrollBottom(),scrollBottomBtn.addEventListener("click",()=>{scrollBottomBtn.classList.add("scrolling"),chatContainer.scrollTop=chatContainer.scrollHeight-chatContainer.clientHeight});
//# sourceMappingURL=public.3682b1eb.js.map
