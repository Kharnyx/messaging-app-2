const local=!0,apiSubDomain="localhost:3000",page="localhost:3000",apiBaseUrl=`http://${page}`,wsUrl=`ws://${page}`,maxReconnectAttempts=5;let reconnectAttempts=0,socket=null,userId="null",authToken="",connectedToServer=!1;function sendToServer(e,n={}){socket&&socket.readyState===WebSocket.OPEN?socket.send(JSON.stringify({type:e,data:n})):console.warn("Socket not open. Message not sent.")}function handleConnection(e){for(let n of(userId=e.userId,authToken=e.authToken,e.conversations)){let e=!1;for(let s=0;s<currentConversations.length;s++)arraysAreEqual(n.users,currentConversations[s])&&(e=!0);e||currentConversations.push({name:n.name,users:n.users})}if(updateConversations(),setSelectedConversation(document.querySelector(".conversation.global-chat")),document.getElementById("displayed-user-id").textContent=`: ${userId}`,sendToServer("get_messages",{authToken}),messagesToSend.length>0){for(let e=0;e<messagesToSend.length;e++)messagesToSend[e].authToken=authToken,messagesToSend[e].senderId=userId,messagesToSend[e].senderName=username.trim()||userId,messagesToSend[e].recipientIds=["global-chat"];sendToServer("message",{authToken:authToken,messages:messagesToSend})}}function handleMessages(e){let n=[];for(let s of e.messages)arraysAreEqual(s.recipientIds,conversationRecipientIds)&&n.push(s);let s=[];for(let e of messages)arraysAreEqual(e.recipientIds,conversationRecipientIds)&&s.push(e);messages=[...e.messages],n.length!=s.length&&loadMessages(e.messages)}function handleCreateConversation(e){tags=[],updateTags(),currentConversations.push({name:e.name,users:e.filteredUsers}),updateConversations()}window.connectWebSocket=function(){(socket=new WebSocket(wsUrl)).onopen=function(){reconnectAttempts=0,connectedToServer=!0,console.log("Connected to server"),socket.send(JSON.stringify({type:"ready"}))},socket.onclose=function(){connectedToServer=!1,reconnectAttempts<5?(reconnectAttempts++,console.log(`Connection lost. Reconnecting in 5s... (Attempt ${reconnectAttempts})`),setTimeout(window.connectWebSocket,5e3)):(console.warn("Reconnection attempts exhausted. Reloading page..."),location.reload())},socket.onerror=function(e){console.error("WebSocket error:",e),connectedToServer=!1},socket.onmessage=function(e){let n=JSON.parse(e.data),s=n.status,o=n.type,t=n.data;if(connectedToServer=!0,console.log("Received message:",n),s&&"success"!==s.code)return void console.log("Server Error:",s.message);switch(o){case"connection":handleConnection(t);break;case"messages":handleMessages(t);break;case"create_conversation":handleCreateConversation(t);break;default:console.warn("Unknown message type:",o)}}},window.onload=function(){window.connectWebSocket()};
//# sourceMappingURL=public.3fd884d7.js.map
