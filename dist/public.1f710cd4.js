const apiSubDomain="localhost:3000",page="localhost:3000",apiBaseUrl=`http://${page}`,wsUrl=`ws://${page}`,maxReconnectAttempts=5;let reconnectAttempts=0,socket=null,userId="null",authToken="";function sendToServer(e,n={}){socket&&socket.readyState===WebSocket.OPEN?socket.send(JSON.stringify({type:e,data:n})):console.warn("Socket not open. Message not sent.")}function handleConnection(e){for(let n of(userId=e.userId,authToken=e.authToken,e.conversations)){let e=!1;for(let t=0;t<currentConversations.length;t++)arraysAreEqual(n.users,currentConversations[t])&&(e=!0);e||currentConversations.push({name:n.name,users:n.users})}updateConversations(),setSelectedConversation(document.querySelector(".conversation.global-chat")),document.getElementById("displayed-user-id").textContent=`: ${userId}`,sendToServer("get_messages",{authToken})}function handleMessages(e){let n=[];for(let t of e.messages)arraysAreEqual(t.recipientIds,conversationRecipientIds)&&n.push(t);let t=[];for(let e of messages)arraysAreEqual(e.recipientIds,conversationRecipientIds)&&t.push(e);messages=[...e.messages],n.length!=t.length&&loadMessages(e.messages)}function handleCreateConversation(e){tags=[],updateTags(),currentConversations.push({name:e.name,users:e.filteredUsers}),updateConversations()}window.connectWebSocket=function(){(socket=new WebSocket(wsUrl)).onopen=function(){reconnectAttempts=0,console.log("Connected to server"),socket.send(JSON.stringify({type:"ready"}))},socket.onclose=function(){reconnectAttempts<5?(reconnectAttempts++,console.log(`Connection lost. Reconnecting in 5s... (Attempt ${reconnectAttempts})`),setTimeout(window.connectWebSocket,5e3)):(console.warn("Reconnection attempts exhausted. Reloading page..."),location.reload())},socket.onerror=function(e){console.error("WebSocket error:",e)},socket.onmessage=function(e){let n=JSON.parse(e.data),t=n.status,o=n.type,s=n.data;if(console.log("Received message:",n),t&&"success"!==t.code)return void console.log("Server Error:",t.message);switch(o){case"connection":handleConnection(s);break;case"messages":handleMessages(s);break;case"create_conversation":handleCreateConversation(s);break;default:console.warn("Unknown message type:",o)}}},window.onload=function(){window.connectWebSocket()};
//# sourceMappingURL=public.1f710cd4.js.map
