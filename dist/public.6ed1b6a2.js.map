{"mappings":"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","sources":["<anon>","public/scripts/web-socket.js"],"sourcesContent":["// scripts/web-socket.js\nconst apiSubDomain = \"messaging-app-bci4\";\nconst page = `${apiSubDomain}.onrender.com`;\nconst apiBaseUrl = `http://${page}`;\nconst wsUrl = `ws://${page}`;\nconst maxReconnectAttempts = 5;\nlet reconnectAttempts = 0;\nlet socket = null;\nlet userId = \"null\";\nlet authToken = \"\";\nwindow.connectWebSocket = function() {\n    socket = new WebSocket(wsUrl);\n    socket.onopen = function() {\n        reconnectAttempts = 0;\n        console.log(\"Connected to server\");\n        socket.send(JSON.stringify({\n            type: \"ready\"\n        }));\n    };\n    socket.onclose = function() {\n        // If the socket closes, attempt to reconnect\n        if (reconnectAttempts < maxReconnectAttempts) {\n            reconnectAttempts++;\n            console.log(`Connection lost. Reconnecting in 5s... (Attempt ${reconnectAttempts})`);\n            setTimeout(window.connectWebSocket, 5000);\n        } else {\n            // Reload the page after maxReconnectAttempts is reached\n            console.warn(\"Reconnection attempts exhausted. Reloading page...\");\n            location.reload();\n        }\n    };\n    socket.onerror = function(error) {\n        console.error(\"WebSocket error:\", error);\n    };\n    socket.onmessage = function(e) {\n        const message = JSON.parse(e.data);\n        const status = message.status;\n        const event = message.type;\n        const payload = message.data;\n        console.log(`Received message:`, message);\n        // console.timeEnd(\"WebsocketRoundtripTime\");\n        if (status && status.code !== \"success\") {\n            console.log(\"Server Error:\", status.message);\n            return;\n        }\n        switch(event){\n            case \"connection\":\n                handleConnection(payload);\n                break;\n            case \"messages\":\n                handleMessages(payload);\n                break;\n            case \"create_conversation\":\n                handleCreateConversation(payload);\n                break;\n            default:\n                console.warn(\"Unknown message type:\", event);\n        }\n    };\n};\nwindow.onload = function() {\n    window.connectWebSocket();\n};\n// Helper function to send messages to the server easier\nfunction sendToServer(action, payload = {}) {\n    if (socket && socket.readyState === WebSocket.OPEN) // console.time(\"WebsocketRoundtripTime\");\n    socket.send(JSON.stringify({\n        type: action,\n        data: payload\n    }));\n    else console.warn(\"Socket not open. Message not sent.\");\n}\n// ----- Helper Functions ----- //\nfunction handleConnection(data) {\n    userId = data.userId;\n    // username =\n    authToken = data.authToken;\n    // console.log(\"Auth:\", authToken, \"User ID:\", userId);\n    // Store the details in the array\n    for (let element of data.conversations){\n        let found = false;\n        for(let i = 0; i < currentConversations.length; i++)if (arraysAreEqual(element.users, currentConversations[i])) found = true;\n        if (!found) currentConversations.push({\n            name: element.name,\n            users: element.users\n        });\n    }\n    updateConversations();\n    setSelectedConversation(document.querySelector(\".conversation.global-chat\"));\n    document.getElementById(\"displayed-user-id\").textContent = `: ${userId}`;\n    // Ask for messages after connection\n    sendToServer(\"get_messages\", {\n        authToken\n    });\n}\nfunction handleMessages(data) {\n    let selectedConversationMessages = [];\n    for (let message of data.messages)if (arraysAreEqual(message.recipientIds, conversationRecipientIds)) selectedConversationMessages.push(message);\n    let currentMessages = [];\n    for (let message of messages)if (arraysAreEqual(message.recipientIds, conversationRecipientIds)) currentMessages.push(message);\n    messages = [\n        ...data.messages\n    ];\n    if (selectedConversationMessages.length != currentMessages.length) loadMessages(data.messages);\n}\nfunction handleCreateConversation(data) {\n    tags = [];\n    updateTags();\n    // Store the details in the array\n    currentConversations.push({\n        name: data.name,\n        users: data.filteredUsers\n    });\n    // console.log(currentConversations);\n    updateConversations();\n}\n\n//# sourceMappingURL=public.6ed1b6a2.js.map\n","// scripts/web-socket.js\r\n\r\nconst apiSubDomain = \"messaging-app-bci4\";\r\nconst page = `${apiSubDomain}.onrender.com`;\r\nconst apiBaseUrl = `http://${page}`;\r\n\r\nconst wsUrl = `ws://${page}`;\r\n\r\nconst maxReconnectAttempts = 5;\r\nlet reconnectAttempts = 0;\r\n\r\nlet socket = null;\r\nlet userId = \"null\";\r\nlet authToken = \"\";\r\n\r\nwindow.connectWebSocket = function () {\r\n    socket = new WebSocket(wsUrl);\r\n\r\n    socket.onopen = function () {\r\n        reconnectAttempts = 0;\r\n        console.log(\"Connected to server\");\r\n        socket.send(JSON.stringify({ type: \"ready\" }));\r\n    };\r\n\r\n    socket.onclose = function () {\r\n        // If the socket closes, attempt to reconnect\r\n        if (reconnectAttempts < maxReconnectAttempts) {\r\n            reconnectAttempts++;\r\n            console.log(`Connection lost. Reconnecting in 5s... (Attempt ${reconnectAttempts})`);\r\n            setTimeout(window.connectWebSocket, 5000);\r\n        } else {\r\n            // Reload the page after maxReconnectAttempts is reached\r\n            console.warn(\"Reconnection attempts exhausted. Reloading page...\");\r\n            location.reload();\r\n        }\r\n    };\r\n\r\n    socket.onerror = function (error) {\r\n        console.error(\"WebSocket error:\", error);\r\n    };\r\n\r\n    socket.onmessage = function (e) {\r\n        const message = JSON.parse(e.data);\r\n        const status = message.status;\r\n        const event = message.type;\r\n        const payload = message.data;\r\n\r\n        console.log(`Received message:`, message);\r\n        // console.timeEnd(\"WebsocketRoundtripTime\");\r\n\r\n        if (status && status.code !== \"success\") {\r\n            console.log(\"Server Error:\", status.message);\r\n\r\n            return;\r\n        }\r\n\r\n        switch (event) {\r\n            case \"connection\":\r\n                handleConnection(payload);\r\n                break;\r\n\r\n            case \"messages\":\r\n                handleMessages(payload);\r\n                break;\r\n\r\n            case \"create_conversation\":\r\n                handleCreateConversation(payload);\r\n                break;\r\n\r\n            default:\r\n                console.warn(\"Unknown message type:\", event);\r\n        }\r\n    };\r\n};\r\n\r\nwindow.onload = function () {\r\n    window.connectWebSocket();\r\n};\r\n\r\n// Helper function to send messages to the server easier\r\nfunction sendToServer(action, payload = {}) {\r\n    if (socket && socket.readyState === WebSocket.OPEN) {\r\n        // console.time(\"WebsocketRoundtripTime\");\r\n        socket.send(\r\n            JSON.stringify({\r\n                type: action,\r\n                data: payload\r\n            })\r\n        );\r\n    } else {\r\n        console.warn(\"Socket not open. Message not sent.\");\r\n    }\r\n}\r\n\r\n\r\n\r\n// ----- Helper Functions ----- //\r\nfunction handleConnection(data) {\r\n    userId = data.userId;\r\n    // username =\r\n    authToken = data.authToken;\r\n    // console.log(\"Auth:\", authToken, \"User ID:\", userId);\r\n\r\n    // Store the details in the array\r\n    for (let element of data.conversations) {\r\n        let found = false;\r\n\r\n        for (let i = 0; i < currentConversations.length; i++) {\r\n            if (arraysAreEqual(element.users, currentConversations[i])) {\r\n                found = true;\r\n            }\r\n        }\r\n\r\n        if (!found) {\r\n            currentConversations.push({\r\n                name: element.name,\r\n                users: element.users\r\n            })\r\n        }\r\n    }\r\n\r\n    updateConversations();\r\n\r\n    setSelectedConversation(document.querySelector(\".conversation.global-chat\"));\r\n\r\n    document.getElementById(\"displayed-user-id\").textContent = `: ${userId}`;\r\n\r\n    // Ask for messages after connection\r\n    sendToServer(\"get_messages\", { authToken });\r\n}\r\n\r\n\r\n\r\n\r\nfunction handleMessages(data) {\r\n    let selectedConversationMessages = [];\r\n    for (let message of data.messages) {\r\n        if (arraysAreEqual(message.recipientIds, conversationRecipientIds)) {\r\n            selectedConversationMessages.push(message);\r\n        }\r\n    }\r\n\r\n    let currentMessages = [];\r\n    for (let message of messages) {\r\n        if (arraysAreEqual(message.recipientIds, conversationRecipientIds)) {\r\n            currentMessages.push(message);\r\n        }\r\n    }\r\n\r\n    messages = [...data.messages];\r\n\r\n    if (selectedConversationMessages.length != currentMessages.length) {\r\n        loadMessages(data.messages);\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfunction handleCreateConversation(data) {\r\n    tags = [];\r\n    updateTags();\r\n\r\n    // Store the details in the array\r\n    currentConversations.push({\r\n        name: data.name,\r\n        users: data.filteredUsers\r\n    });\r\n\r\n    // console.log(currentConversations);\r\n\r\n    updateConversations();\r\n}"],"names":["apiSubDomain","page","apiBaseUrl","wsUrl","maxReconnectAttempts","reconnectAttempts","socket","userId","authToken","sendToServer","action","payload","readyState","WebSocket","OPEN","send","JSON","stringify","type","data","console","warn","handleConnection","element","conversations","found","i","currentConversations","length","arraysAreEqual","users","push","name","updateConversations","setSelectedConversation","document","querySelector","getElementById","textContent","handleMessages","selectedConversationMessages","message","messages","recipientIds","conversationRecipientIds","currentMessages","loadMessages","handleCreateConversation","tags","updateTags","filteredUsers","window","connectWebSocket","onopen","log","onclose","setTimeout","location","reload","onerror","error","onmessage","e","parse","status","event","code","onload"],"version":3,"file":"public.6ed1b6a2.js.map"}