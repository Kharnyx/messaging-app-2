{"mappings":"ACGA,MAAM,SAAW,SAAS,gBAAgB,CAAC,YACrC,aAAe,SAAS,aAAa,CAAC,kBACtC,eAAiB,SAAS,aAAa,CAAC,wBACxC,cAAgB,SAAS,aAAa,CAAC,mBACvC,SAAW,cAAc,aAAa,CAAC,cAGvC,cAAgB,SAAS,cAAc,CAAC,sBAC1C,gBAAkB,SAAS,cAAc,CAAC,qBAE9C,IAAI,cAAgB,EAAE,CAClB,SAAW,GAEX,yBAA2B,EAAE,CAC7B,SAAW,EAAE,CAmCjB,SAAS,sBACL,IAAM,EAAkB,SAAS,sBAAsB,CAAC,qBAElD,EAAO,UACP,EAAY,UAElB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAgB,MAAM,CAAE,IAAK,CAC7C,IAAM,EAAU,CAAe,CAAC,EAAE,CAC5B,EAAM,EAAQ,aAAa,CAAC,YAC5B,EAAW,EAAQ,SAAS,CAAC,QAAQ,CAAC,WAEtC,EAAO,CAAe,CAAC,EAAI,EAAE,CAC7B,EAAO,CAAe,CAAC,EAAI,EAAE,CAE7B,EAAW,GAAQ,EAAK,SAAS,CAAC,QAAQ,CAAC,EAAW,UAAY,eAClE,EAAW,GAAQ,EAAK,SAAS,CAAC,QAAQ,CAAC,EAAW,UAAY,eAGpE,EAAY,EACZ,EAAe,CAEf,CAAA,GAAU,CAAA,EAAY,CAA1B,EACI,GAAU,CAAA,EAAe,CAA7B,EAGI,GACA,EAAI,KAAK,CAAC,oBAAoB,CAAG,EACjC,EAAI,KAAK,CAAC,uBAAuB,CAAG,IAEpC,EAAI,KAAK,CAAC,mBAAmB,CAAG,EAChC,EAAI,KAAK,CAAC,sBAAsB,CAAG,GAGnC,AAAC,GAAa,GACd,CAAA,EAAI,KAAK,CAAC,mBAAmB,CAAG,CADpC,EAKA,EAAQ,KAAK,CAAC,YAAY,CAAG,GAAY,CAAC,EAAO,UAAY,MACjE,CACJ,CAxEA,aAAa,aAAa,CAAC,gBAAgB,CAAC,QAAS,KAErD,GAGA,aAAa,gBAAgB,CAAC,QAAS,KACnC,mBAAmB,aACvB,GAGA,SAAS,gBAAgB,CAAC,UAAW,SAAU,CAAC,EAChC,EAAE,GAAG,CAAC,WAAW,EACjC,GAGA,cAAc,gBAAgB,CAAC,QAAS,KACpC,gBAAgB,KAAK,EACzB,GAGA,gBAAgB,gBAAgB,CAAC,SAAU,KACvC,GAAI,gBAAgB,KAAK,CAAC,MAAM,CAAG,EAAG,CAClC,IAAM,EAAgB,gBAAgB,KAAK,CAC3C,cAAc,IAAI,CAAC,EAEvB,CACJ,GAGA,eAAe,gBAAgB,CAAC,QAAS,aA8CzC,sBAGA,MAAM,oBAAsB,SAAS,gBAAgB,CAAC,+CAEtD,IAAK,IAAI,WAAW,oBAAqB,CACrC,MAAM,EAAM,QAAQ,aAAa,CAAC,MAGlC,CAAA,EAAI,OAAO,CAAG,KACV,EAAI,KAAK,CAAC,OAAO,CAAG,MACxB,EAEI,AAAkB,IAAlB,EAAI,GAAG,CAAC,IAAI,IACZ,CAAA,EAAI,KAAK,CAAC,OAAO,CAAG,MADxB,CAGJ,CAIA,SAAS,cACL,IAAM,EAAU,aAAa,KAAK,CAAC,IAAI,GACvC,GAAI,EAAQ,MAAM,CAAG,GAAK,cAAc,MAAM,CAAG,EAAG,YAChD,QAAQ,IAAI,CAAC,cAKjB,IAAM,EAAmB,IAAI,KACvB,EAAqB,OAAO,eAAe,CAAC,KAAK,CAAC,GAcxD,aAAa,UAVO,CAChB,UAAW,UACX,SALkB,OAMlB,WALoB,SAAS,IAAI,IAAM,OAMvC,YAAa,EACb,SAAU,EACV,aAAc,wBAClB,GAMA,aAAa,KAAK,CAAG,GACrB,mBAAmB,aACvB,CAeA,SAAS,cAAc,CAAI,CAAE,CAAQ,EACjC,IAAM,EAAW,EAAK,QAAQ,GAAK,OAC7B,EAAmB,SAAS,aAAa,CAAC,OAChD,EAAiB,SAAS,CAAC,GAAG,CAAC,oBAAqB,EAAW,UAAY,eAE3E,IAAM,EAAW,IAAI,KAAK,EAAK,QAAQ,EACjC,EAAU,EAAK,QAAQ,CACzB,OAAO,iBAAiB,CAAC,EAAK,QAAQ,EACpC,eAIA,EAAY,SAAS,aAAa,CAAC,OACnC,EAAgB,SAAS,aAAa,CAAC,IAC7C,CAAA,EAAc,WAAW,CALA,EAMzB,EAAU,SAAS,CAAC,GAAG,CAAC,aAExB,EAAU,WAAW,CAAC,GAEtB,IAAM,EAAc,EAAS,WAAW,GAAK,EAEvC,CAAC,EAAS,EAAQ,EAAU,EAAQ,CAAG,CACzC,EAAS,UAAU,GACnB,EAAS,cAAc,CAAC,QAAS,CAC7B,QAAS,QACT,SAAU,KACd,GACA,EAAS,cAAc,CAAC,QAAS,CAC7B,MAAO,QACP,SAAU,KACd,GACA,EAAS,WAAW,GACvB,AAEmB,CAAc,OAAO,GAAa,QAAQ,CAAC,EAAG,KAAQ,OAAO,GAAS,QAAQ,CAAC,EAAG,KAGtG,IAAM,EAAS,SAAS,aAAa,CAAC,OACtC,EAAO,SAAS,CAAC,GAAG,CAAC,UACrB,IAAM,EAAU,SAAS,aAAa,CAAC,OACvC,EAAQ,SAAS,CAAC,GAAG,CAAC,mBACtB,IAAM,EAAe,SAAS,aAAa,CAAC,OAEtC,EAAgB,SAAS,aAAa,CAAC,OAC7C,EAAc,SAAS,CAAC,GAAG,CAAC,eAC5B,EAAc,WAAW,CAAG,EAAK,UAAU,CAG3C,IAAM,EAAQ,SAAS,aAAa,CAAC,OACrC,EAAM,SAAS,CAAC,GAAG,CAAC,SAEpB,IAAM,EAAU,SAAS,aAAa,CAAC,OACvC,EAAQ,SAAS,CAAC,GAAG,CAAC,UAAW,iBACjC,IAAM,EAAe,SAAS,aAAa,CAAC,OAC5C,EAAa,SAAS,CAAC,GAAG,CAAC,SAC3B,IAAM,EAAmB,SAAS,aAAa,CAAC,QAiBhD,GAhBA,EAAiB,WAAW,CAAG,EAAK,WAAW,CAE/C,EAAa,WAAW,CAAC,GACzB,EAAQ,WAAW,CAAC,GACpB,EAAQ,WAAW,CAAC,GACpB,EAAO,WAAW,CAAC,GACnB,EAAO,WAAW,CAAC,GAEnB,EAAiB,WAAW,CAAC,GAC7B,EAAiB,WAAW,CAAC,GAC7B,EAAiB,WAAW,CAAC,GAC7B,EAAiB,WAAW,CAAC,GAKzB,CAAC,EAAa,GAAG,CAAE,CACnB,EAAa,MAAM,GACnB,IAAM,EAAW,SAAS,aAAa,CAAC,IACxC,CAAA,EAAS,SAAS,CAAG,0BACrB,EAAS,EAAE,CAAG,CAAA,EAAG,EAAK,UAAU,CAAC,KAAK,CAAC,CACnC,EAAK,aAAa,EAAE,CAAA,EAAS,KAAK,CAAC,KAAK,CAAG,EAAK,aAAa,AAAb,EACpD,EAAQ,WAAW,CAAC,EACxB,CAGA,GAAI,EAAU,CACV,IAAM,EAAW,KAAK,KAAK,CAAC,EAAS,QAAQ,CAIzC,CAHY,KAAK,KAAK,CAAC,EAAK,QAAQ,EAG1B,EAAW,KACrB,EAAU,SAAS,CAAC,GAAG,CAAC,QAIxB,EAAK,QAAQ,GAAK,EAAS,QAAQ,EACnC,EAAO,MAAM,GAIZ,UAAU,EAAU,EAAS,QAAQ,IACtC,EAAU,SAAS,CAAC,GAAG,CAAC,WACxB,EAAc,WAAW,CAAG,CAAA,EAAG,EAAO,EAAE,EAAE,EAAQ,CAAC,EAAE,EAAS,IAAI,EA1FjD,EA0FmD,CAAkB,CAE9F,MAEI,EAAU,SAAS,CAAC,GAAG,CAAC,WACxB,EAAc,WAAW,CAAG,CAAA,EAAG,EAAO,EAAE,EAAE,EAAQ,CAAC,EAAE,EAAS,IAAI,EA/F7C,EA+F+C,CAAkB,CAG1F,OAAO,CACX,CAKA,SAAS,aAAa,CAAQ,EAE1B,KAAO,SAAS,UAAU,EACtB,SAAS,UAAU,CAAC,MAAM,GAG9B,IAAI,EAAiB,EAAE,CACvB,IAAK,IAAI,KAAW,EACZ,eAAe,EAAQ,YAAY,CAAE,2BACrC,EAAe,IAAI,CAAC,EAIxB,CAAA,EAAe,MAAM,CAAG,GAExB,CAAA,AADmB,SAAS,aAAa,CAAC,KAC/B,WAAW,CAAG,aAAzB,EAGJ,IAAK,IAAI,EAAI,EAAG,EAAI,EAAe,MAAM,CAAE,IAAK,CAC5C,IAAI,EAAiB,EAAI,EAAI,cAAc,CAAc,CAAC,EAAE,CAAE,CAAc,CAAC,EAAI,EAAE,EAAI,cAAc,CAAc,CAAC,EAAE,CAClH,CAAA,EAAe,aAAa,CAAC,aAC7B,SAAS,WAAW,CAAC,EAAe,aAAa,CAAC,aAEtD,SAAS,WAAW,CAAC,EACzB,CAEA,sBACA,cAAc,SAAS,CAAG,cAAc,YAAY,CAAG,cAAc,YAAY,AAGrF,CA1JA,OAAO,iBAAiB,CAAG,SAAU,CAAY,EAE7C,OAAO,AADM,IAAI,KAAK,GACV,kBAAkB,CAAC,EAAE,CAAE,CAC/B,KAAM,UACN,OAAQ,UACR,OAAQ,CAAA,CACZ,EACJ,EAqJA,MAAM,gBAAkB,SAAS,cAAc,CAAC,iBAEhD,SAAS,qBACL,IAAM,EAAY,cAAc,SAAS,CACnC,EAAe,cAAc,YAAY,AAE9B,CAAA,EADI,cAAc,YAAY,EACF,EAAgB,EAAI,cAG7D,gBAAgB,SAAS,CAAC,GAAG,CAAC,QAE1B,gBAAgB,SAAS,CAAC,QAAQ,CAAC,cACnC,gBAAgB,SAAS,CAAC,MAAM,CAAC,cAGrC,gBAAgB,SAAS,CAAC,MAAM,CAAC,OAEzC,CAEA,cAAc,gBAAgB,CAAC,SAAU,oBAEzC,qBAEA,gBAAgB,gBAAgB,CAAC,QAAS,KACtC,gBAAgB,SAAS,CAAC,GAAG,CAAC,aAC9B,cAAc,SAAS,CAAG,cAAc,YAAY,CAAG,cAAc,YAAY,AACrF","sources":["<anon>","public/scripts/message.js"],"sourcesContent":["// scripts/message.js\n// Select DOM elements for message input, send button, chat container, etc.\nconst textarea = document.querySelectorAll(\"textarea\");\nconst messageInput = document.querySelector(\"#message-input\");\nconst sendMessageBtn = document.querySelector(\"#send-message-button\");\nconst chatContainer = document.querySelector(\"#chat-container\");\nconst chatBody = chatContainer.querySelector(\"#chat-body\");\n// File attachment button and input\nconst attachFileBtn = document.getElementById(\"attach-file-button\"), attachFileInput = document.getElementById(\"attach-file-input\");\nlet attachedFiles = []; // Stores attached files for messages\nlet username = \"\"; // Current user's username\nlet conversationRecipientIds = []; // Users in the selected conversation\nlet messages = [];\n// Focus message input when parent is clicked (currently commented out)\nmessageInput.parentElement.addEventListener(\"click\", ()=>{\n// messageInput.focus();\n});\n// Auto-resize textarea as user types\nmessageInput.addEventListener(\"input\", ()=>{\n    updateTextareaSize(messageInput);\n});\n// Listen for keydown events (currently not used)\ndocument.addEventListener(\"keydown\", function(e) {\n    const key = e.key.toLowerCase();\n});\n// Open file picker when attach button is clicked\nattachFileBtn.addEventListener(\"click\", ()=>{\n    attachFileInput.click();\n});\n// Handle file selection and add to attachedFiles array\nattachFileInput.addEventListener(\"change\", ()=>{\n    if (attachFileInput.files.length > 0) {\n        const selectedFiles = attachFileInput.files;\n        attachedFiles.push(selectedFiles);\n    // console.log(attachedFiles);\n    }\n});\n// Send message when send button is clicked\nsendMessageBtn.addEventListener(\"click\", sendMessage);\n// Adjusts message bubble border radius and spacing based on neighbors\nfunction updateMessageStyles() {\n    const messageElements = document.getElementsByClassName(\"message-container\");\n    const same = \"0.25rem\";\n    const different = \"1.25rem\";\n    for(let i = 0; i < messageElements.length; i++){\n        const element = messageElements[i];\n        const box = element.querySelector(\".message\");\n        const isFromMe = element.classList.contains(\"from-me\");\n        const prev = messageElements[i - 1];\n        const next = messageElements[i + 1];\n        const prevSame = prev && prev.classList.contains(isFromMe ? \"from-me\" : \"from-others\");\n        const nextSame = next && next.classList.contains(isFromMe ? \"from-me\" : \"from-others\");\n        // Pick radius based on neighbors\n        let topRadius = different;\n        let bottomRadius = different;\n        if (prevSame) topRadius = same;\n        if (nextSame) bottomRadius = same;\n        // Apply to correct side\n        if (isFromMe) {\n            box.style.borderTopRightRadius = topRadius;\n            box.style.borderBottomRightRadius = bottomRadius;\n        } else {\n            box.style.borderTopLeftRadius = topRadius;\n            box.style.borderBottomLeftRadius = bottomRadius;\n        }\n        if (!prevSame && !isFromMe) box.style.borderTopLeftRadius = same;\n        // Adjust spacing\n        element.style.marginBottom = nextSame || !next ? \"0.25rem\" : \"2rem\";\n    }\n}\n// Initial call to style messages\nupdateMessageStyles();\n// Hide broken or empty profile images in message bubbles\nconst userProfilePictures = document.querySelectorAll(\".message-container .sender .profile-picture\");\nfor (let element of userProfilePictures){\n    const img = element.querySelector(\"img\");\n    // console.log(img)\n    img.onerror = ()=>{\n        img.style.display = \"none\";\n    };\n    if (img.src.trim() == \"\") img.style.display = \"none\";\n}\n// Sends a message to the server and clears the input.\nfunction sendMessage() {\n    const message = messageInput.value.trim();\n    if (message.length < 1 && attachedFiles.length < 1) {\n        console.warn(\"No message\");\n        return;\n    }\n    // Create the data structure for the message\n    const currentTimestamp = new Date();\n    const cleanedMessageText = window.ProfanityFilter.clean(message);\n    const currentUserId = userId;\n    const currentUserName = username.trim() || userId;\n    const messageData = {\n        authToken: authToken,\n        senderId: currentUserId,\n        senderName: currentUserName,\n        messageText: cleanedMessageText,\n        sentTime: currentTimestamp,\n        recipientIds: conversationRecipientIds\n    };\n    // Send the message to the server\n    sendToServer(\"message\", messageData);\n    // Clear message input\n    messageInput.value = \"\";\n    updateTextareaSize(messageInput);\n}\n// Formats a UTC timestamp to 12-hour time\nwindow.formatUTCTo12Hour = function(utcTimestamp) {\n    const data = new Date(utcTimestamp);\n    return data.toLocaleTimeString([], {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: true\n    });\n};\n// Creates a DOM element for a single message.\n// Handles grouping, timestamps, and sender display.\nfunction createMessage(data, previous) {\n    const isFromMe = data.senderId === userId;\n    const messageContainer = document.createElement(\"div\");\n    messageContainer.classList.add(\"message-container\", isFromMe ? \"from-me\" : \"from-others\");\n    const msgDates = new Date(data.sentTime);\n    const msgTime = data.sentTime ? window.formatUTCTo12Hour(data.sentTime) : \"Unknown Time\";\n    const formatedSentTime = msgTime;\n    // Timestamp element\n    const timestamp = document.createElement(\"div\");\n    const timestampText = document.createElement(\"p\");\n    timestampText.textContent = formatedSentTime;\n    timestamp.classList.add(\"sent-time\");\n    timestamp.appendChild(timestampText);\n    const monthNumber = msgDates.getUTCMonth() + 1;\n    const [msgDate, msgDay, msgMonth, msgYear] = [\n        msgDates.getUTCDate(),\n        msgDates.toLocaleString(\"en-us\", {\n            weekday: \"short\",\n            timeZone: \"UTC\"\n        }),\n        msgDates.toLocaleString(\"en-us\", {\n            month: \"short\",\n            timeZone: \"UTC\"\n        }),\n        msgDates.getFullYear()\n    ];\n    const msgFullDate = `${msgYear}-${String(monthNumber).padStart(2, \"0\")}-${String(msgDate).padStart(0, \"0\")}`;\n    // Sender info\n    const sender = document.createElement(\"div\");\n    sender.classList.add(\"sender\");\n    const profile = document.createElement(\"div\");\n    profile.classList.add(\"profile-picture\");\n    const profileImage = document.createElement(\"img\");\n    // profileImage.src = \n    const profileSender = document.createElement(\"div\");\n    profileSender.classList.add(\"sender-name\");\n    profileSender.textContent = data.senderName;\n    // Message files (if any)\n    const files = document.createElement(\"div\");\n    files.classList.add(\"files\");\n    // Message text\n    const message = document.createElement(\"div\");\n    message.classList.add(\"message\", \"ripple-button\");\n    const messageLabel = document.createElement(\"div\");\n    messageLabel.classList.add(\"label\");\n    const messageLabelText = document.createElement(\"span\");\n    messageLabelText.textContent = data.messageText;\n    messageLabel.appendChild(messageLabelText);\n    message.appendChild(messageLabel);\n    profile.appendChild(profileImage);\n    sender.appendChild(profile);\n    sender.appendChild(profileSender);\n    messageContainer.appendChild(timestamp);\n    messageContainer.appendChild(sender);\n    messageContainer.appendChild(files);\n    messageContainer.appendChild(message);\n    // Add ripple effect to loaded messages\n    // setUpRipple(message);\n    if (!profileImage.src) {\n        profileImage.remove();\n        const userIcon = document.createElement(\"i\");\n        userIcon.className = \"fa-solid fa-circle-user\";\n        userIcon.id = `${data.senderName}-icon`;\n        if (data.profileColour) userIcon.style.color = data.profileColour;\n        profile.appendChild(userIcon);\n    }\n    // Handle grouping and timestamp display based on previous message\n    if (previous) {\n        const prevTime = Date.parse(previous.sentTime);\n        const current = Date.parse(data.sentTime);\n        // Hide timestamp if sent within 1 minute of previous message\n        if (current - prevTime < 60000) timestamp.classList.add(\"hide\");\n        // Remove sender info if same sender as previous message\n        if (data.senderId === previous.senderId) sender.remove();\n        // Show new day label if message is on a different day\n        if (!isSameDay(msgDates, previous.sentTime)) {\n            timestamp.classList.add(\"new-day\");\n            timestampText.textContent = `${msgDay}, ${msgDate} ${msgMonth} at ${formatedSentTime}`;\n        }\n    } else {\n        // First message in list, always show new day label\n        timestamp.classList.add(\"new-day\");\n        timestampText.textContent = `${msgDay}, ${msgDate} ${msgMonth} at ${formatedSentTime}`;\n    }\n    return messageContainer;\n}\n// Loads an array of messages into the chat body.\n// Clears previous messages and appends new ones.\nfunction loadMessages(messages) {\n    // console.time(\"Loading Messages\");\n    while(chatBody.firstChild)chatBody.firstChild.remove();\n    let messagesToLoad = [];\n    for (let message of messages)if (arraysAreEqual(message.recipientIds, conversationRecipientIds)) messagesToLoad.push(message);\n    if (messagesToLoad.length < 1) {\n        const noMessages = document.createElement(\"p\");\n        noMessages.textContent = \"No messages\";\n    }\n    for(let i = 0; i < messagesToLoad.length; i++){\n        let messageElement = i > 0 ? createMessage(messagesToLoad[i], messagesToLoad[i - 1]) : createMessage(messagesToLoad[i]);\n        if (messageElement.querySelector(\".new-day\")) chatBody.appendChild(messageElement.querySelector(\".new-day\"));\n        chatBody.appendChild(messageElement);\n    }\n    updateMessageStyles();\n    chatContainer.scrollTop = chatContainer.scrollHeight - chatContainer.clientHeight;\n// console.timeEnd(\"Messages Loaded\");\n}\nconst scrollBottomBtn = document.getElementById(\"scroll-bottom\");\nfunction updateScrollBottom() {\n    const scrollTop = chatContainer.scrollTop;\n    const scrollHeight = chatContainer.scrollHeight;\n    const clientHeight = chatContainer.clientHeight;\n    const atBottom = scrollTop + clientHeight >= scrollHeight - 2 * rootFontSize;\n    if (atBottom) {\n        scrollBottomBtn.classList.add(\"hide\");\n        if (scrollBottomBtn.classList.contains(\"scrolling\")) scrollBottomBtn.classList.remove(\"scrolling\");\n    } else scrollBottomBtn.classList.remove(\"hide\");\n}\nchatContainer.addEventListener(\"scroll\", updateScrollBottom);\nupdateScrollBottom();\nscrollBottomBtn.addEventListener(\"click\", ()=>{\n    scrollBottomBtn.classList.add(\"scrolling\");\n    chatContainer.scrollTop = chatContainer.scrollHeight - chatContainer.clientHeight;\n});\n\n//# sourceMappingURL=public.7486c304.js.map\n","// scripts/message.js\r\n\r\n// Select DOM elements for message input, send button, chat container, etc.\r\nconst textarea = document.querySelectorAll(\"textarea\");\r\nconst messageInput = document.querySelector(\"#message-input\");\r\nconst sendMessageBtn = document.querySelector(\"#send-message-button\");\r\nconst chatContainer = document.querySelector(\"#chat-container\");\r\nconst chatBody = chatContainer.querySelector(\"#chat-body\");\r\n\r\n// File attachment button and input\r\nconst attachFileBtn = document.getElementById(\"attach-file-button\"),\r\n    attachFileInput = document.getElementById(\"attach-file-input\");\r\n\r\nlet attachedFiles = []; // Stores attached files for messages\r\nlet username = \"\"; // Current user's username\r\n\r\nlet conversationRecipientIds = []; // Users in the selected conversation\r\nlet messages = [];\r\n\r\n// Focus message input when parent is clicked (currently commented out)\r\nmessageInput.parentElement.addEventListener(\"click\", () => {\r\n    // messageInput.focus();\r\n});\r\n\r\n// Auto-resize textarea as user types\r\nmessageInput.addEventListener(\"input\", () => {\r\n    updateTextareaSize(messageInput);\r\n});\r\n\r\n// Listen for keydown events (currently not used)\r\ndocument.addEventListener(\"keydown\", function (e) {\r\n    const key = e.key.toLowerCase();\r\n});\r\n\r\n// Open file picker when attach button is clicked\r\nattachFileBtn.addEventListener(\"click\", () => {\r\n    attachFileInput.click();\r\n});\r\n\r\n// Handle file selection and add to attachedFiles array\r\nattachFileInput.addEventListener(\"change\", () => {\r\n    if (attachFileInput.files.length > 0) {\r\n        const selectedFiles = attachFileInput.files;\r\n        attachedFiles.push(selectedFiles);\r\n        // console.log(attachedFiles);\r\n    }\r\n});\r\n\r\n// Send message when send button is clicked\r\nsendMessageBtn.addEventListener(\"click\", sendMessage);\r\n\r\n// Adjusts message bubble border radius and spacing based on neighbors\r\nfunction updateMessageStyles() {\r\n    const messageElements = document.getElementsByClassName(\"message-container\");\r\n\r\n    const same = \"0.25rem\";\r\n    const different = \"1.25rem\";\r\n\r\n    for (let i = 0; i < messageElements.length; i++) {\r\n        const element = messageElements[i];\r\n        const box = element.querySelector(\".message\");\r\n        const isFromMe = element.classList.contains(\"from-me\");\r\n\r\n        const prev = messageElements[i - 1];\r\n        const next = messageElements[i + 1];\r\n\r\n        const prevSame = prev && prev.classList.contains(isFromMe ? \"from-me\" : \"from-others\");\r\n        const nextSame = next && next.classList.contains(isFromMe ? \"from-me\" : \"from-others\");\r\n\r\n        // Pick radius based on neighbors\r\n        let topRadius = different;\r\n        let bottomRadius = different;\r\n\r\n        if (prevSame) topRadius = same;\r\n        if (nextSame) bottomRadius = same;\r\n\r\n        // Apply to correct side\r\n        if (isFromMe) {\r\n            box.style.borderTopRightRadius = topRadius;\r\n            box.style.borderBottomRightRadius = bottomRadius;\r\n        } else {\r\n            box.style.borderTopLeftRadius = topRadius;\r\n            box.style.borderBottomLeftRadius = bottomRadius;\r\n        }\r\n\r\n        if (!prevSame && !isFromMe) {\r\n            box.style.borderTopLeftRadius = same;\r\n        }\r\n\r\n        // Adjust spacing\r\n        element.style.marginBottom = nextSame || !next ? \"0.25rem\" : \"2rem\";\r\n    }\r\n}\r\n\r\n// Initial call to style messages\r\nupdateMessageStyles();\r\n\r\n// Hide broken or empty profile images in message bubbles\r\nconst userProfilePictures = document.querySelectorAll(\".message-container .sender .profile-picture\");\r\n\r\nfor (let element of userProfilePictures) {\r\n    const img = element.querySelector(\"img\");\r\n    // console.log(img)\r\n\r\n    img.onerror = () => {\r\n        img.style.display = \"none\";\r\n    };\r\n\r\n    if (img.src.trim() == \"\") {\r\n        img.style.display = \"none\";\r\n    }\r\n}\r\n\r\n\r\n// Sends a message to the server and clears the input.\r\nfunction sendMessage() {\r\n    const message = messageInput.value.trim();\r\n    if (message.length < 1 && attachedFiles.length < 1) {\r\n        console.warn(\"No message\");\r\n        return;\r\n    }\r\n\r\n    // Create the data structure for the message\r\n    const currentTimestamp = new Date();\r\n    const cleanedMessageText = window.ProfanityFilter.clean(message);\r\n    const currentUserId = userId;\r\n    const currentUserName = username.trim() || userId;\r\n\r\n    const messageData = {\r\n        authToken: authToken,\r\n        senderId: currentUserId,\r\n        senderName: currentUserName,\r\n        messageText: cleanedMessageText,\r\n        sentTime: currentTimestamp,\r\n        recipientIds: conversationRecipientIds,\r\n    };\r\n\r\n    // Send the message to the server\r\n    sendToServer(\"message\", messageData);\r\n\r\n    // Clear message input\r\n    messageInput.value = \"\";\r\n    updateTextareaSize(messageInput);\r\n}\r\n\r\n\r\n// Formats a UTC timestamp to 12-hour time\r\nwindow.formatUTCTo12Hour = function (utcTimestamp) {\r\n    const data = new Date(utcTimestamp);\r\n    return data.toLocaleTimeString([], {\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n        hour12: true\r\n    });\r\n};\r\n\r\n// Creates a DOM element for a single message.\r\n// Handles grouping, timestamps, and sender display.\r\nfunction createMessage(data, previous) {\r\n    const isFromMe = data.senderId === userId;\r\n    const messageContainer = document.createElement(\"div\");\r\n    messageContainer.classList.add(\"message-container\", isFromMe ? \"from-me\" : \"from-others\");\r\n\r\n    const msgDates = new Date(data.sentTime);\r\n    const msgTime = data.sentTime ?\r\n        window.formatUTCTo12Hour(data.sentTime)\r\n        : \"Unknown Time\";\r\n    const formatedSentTime = msgTime;\r\n\r\n    // Timestamp element\r\n    const timestamp = document.createElement(\"div\");\r\n    const timestampText = document.createElement(\"p\");\r\n    timestampText.textContent = formatedSentTime;\r\n    timestamp.classList.add(\"sent-time\");\r\n\r\n    timestamp.appendChild(timestampText);\r\n\r\n    const monthNumber = msgDates.getUTCMonth() + 1;\r\n\r\n    const [msgDate, msgDay, msgMonth, msgYear] = [\r\n        msgDates.getUTCDate(),\r\n        msgDates.toLocaleString(\"en-us\", {\r\n            weekday: \"short\",\r\n            timeZone: \"UTC\",\r\n        }),\r\n        msgDates.toLocaleString(\"en-us\", {\r\n            month: \"short\",\r\n            timeZone: \"UTC\",\r\n        }),\r\n        msgDates.getFullYear(),\r\n    ];\r\n\r\n    const msgFullDate = `${msgYear}-${String(monthNumber).padStart(2, \"0\")}-${String(msgDate).padStart(0, \"0\")}`;\r\n\r\n    // Sender info\r\n    const sender = document.createElement(\"div\");\r\n    sender.classList.add(\"sender\");\r\n    const profile = document.createElement(\"div\");\r\n    profile.classList.add(\"profile-picture\");\r\n    const profileImage = document.createElement(\"img\");\r\n    // profileImage.src = \r\n    const profileSender = document.createElement(\"div\");\r\n    profileSender.classList.add(\"sender-name\");\r\n    profileSender.textContent = data.senderName;\r\n\r\n    // Message files (if any)\r\n    const files = document.createElement(\"div\");\r\n    files.classList.add(\"files\");\r\n    // Message text\r\n    const message = document.createElement(\"div\");\r\n    message.classList.add(\"message\", \"ripple-button\");\r\n    const messageLabel = document.createElement(\"div\");\r\n    messageLabel.classList.add(\"label\");\r\n    const messageLabelText = document.createElement(\"span\");\r\n    messageLabelText.textContent = data.messageText;\r\n\r\n    messageLabel.appendChild(messageLabelText);\r\n    message.appendChild(messageLabel);\r\n    profile.appendChild(profileImage);\r\n    sender.appendChild(profile);\r\n    sender.appendChild(profileSender);\r\n\r\n    messageContainer.appendChild(timestamp);\r\n    messageContainer.appendChild(sender);\r\n    messageContainer.appendChild(files);\r\n    messageContainer.appendChild(message);\r\n\r\n    // Add ripple effect to loaded messages\r\n    // setUpRipple(message);\r\n\r\n    if (!profileImage.src) {\r\n        profileImage.remove();\r\n        const userIcon = document.createElement(\"i\");\r\n        userIcon.className = \"fa-solid fa-circle-user\";\r\n        userIcon.id = `${data.senderName}-icon`\r\n        if (data.profileColour) userIcon.style.color = data.profileColour;\r\n        profile.appendChild(userIcon);\r\n    }\r\n\r\n    // Handle grouping and timestamp display based on previous message\r\n    if (previous) {\r\n        const prevTime = Date.parse(previous.sentTime);\r\n        const current = Date.parse(data.sentTime);\r\n\r\n        // Hide timestamp if sent within 1 minute of previous message\r\n        if (current - prevTime < 1 * 60 * 1000) {\r\n            timestamp.classList.add(\"hide\");\r\n        }\r\n\r\n        // Remove sender info if same sender as previous message\r\n        if (data.senderId === previous.senderId) {\r\n            sender.remove();\r\n        }\r\n\r\n        // Show new day label if message is on a different day\r\n        if (!isSameDay(msgDates, previous.sentTime)) {\r\n            timestamp.classList.add(\"new-day\");\r\n            timestampText.textContent = `${msgDay}, ${msgDate} ${msgMonth} at ${formatedSentTime}`;\r\n        }\r\n    } else {\r\n        // First message in list, always show new day label\r\n        timestamp.classList.add(\"new-day\");\r\n        timestampText.textContent = `${msgDay}, ${msgDate} ${msgMonth} at ${formatedSentTime}`;\r\n    }\r\n\r\n    return messageContainer;\r\n}\r\n\r\n\r\n// Loads an array of messages into the chat body.\r\n// Clears previous messages and appends new ones.\r\nfunction loadMessages(messages) {\r\n    // console.time(\"Loading Messages\");\r\n    while (chatBody.firstChild) {\r\n        chatBody.firstChild.remove();\r\n    }\r\n\r\n    let messagesToLoad = [];\r\n    for (let message of messages) {\r\n        if (arraysAreEqual(message.recipientIds, conversationRecipientIds)) {\r\n            messagesToLoad.push(message);\r\n        }\r\n    }\r\n\r\n    if (messagesToLoad.length < 1) {\r\n        const noMessages = document.createElement(\"p\");\r\n        noMessages.textContent = \"No messages\";\r\n    }\r\n\r\n    for (let i = 0; i < messagesToLoad.length; i++) {\r\n        let messageElement = i > 0 ? createMessage(messagesToLoad[i], messagesToLoad[i - 1]) : createMessage(messagesToLoad[i]);\r\n        if (messageElement.querySelector(\".new-day\")) {\r\n            chatBody.appendChild(messageElement.querySelector(\".new-day\"));\r\n        }\r\n        chatBody.appendChild(messageElement);\r\n    }\r\n\r\n    updateMessageStyles();\r\n    chatContainer.scrollTop = chatContainer.scrollHeight - chatContainer.clientHeight;\r\n\r\n    // console.timeEnd(\"Messages Loaded\");\r\n}\r\n\r\nconst scrollBottomBtn = document.getElementById(\"scroll-bottom\");\r\n\r\nfunction updateScrollBottom() {\r\n    const scrollTop = chatContainer.scrollTop;\r\n    const scrollHeight = chatContainer.scrollHeight;\r\n    const clientHeight = chatContainer.clientHeight;\r\n    const atBottom = scrollTop + clientHeight >= scrollHeight - (2 * rootFontSize);\r\n\r\n    if (atBottom) {\r\n        scrollBottomBtn.classList.add(\"hide\");\r\n\r\n        if (scrollBottomBtn.classList.contains(\"scrolling\")) {\r\n            scrollBottomBtn.classList.remove(\"scrolling\");\r\n        }\r\n    } else {\r\n        scrollBottomBtn.classList.remove(\"hide\");\r\n    }\r\n}\r\n\r\nchatContainer.addEventListener(\"scroll\", updateScrollBottom);\r\n\r\nupdateScrollBottom();\r\n\r\nscrollBottomBtn.addEventListener(\"click\", () => {\r\n    scrollBottomBtn.classList.add(\"scrolling\");\r\n    chatContainer.scrollTop = chatContainer.scrollHeight - chatContainer.clientHeight;\r\n});"],"names":["textarea","document","querySelectorAll","messageInput","querySelector","sendMessageBtn","chatContainer","chatBody","attachFileBtn","getElementById","attachFileInput","attachedFiles","username","conversationRecipientIds","messages","updateMessageStyles","messageElements","getElementsByClassName","same","different","i","length","element","box","isFromMe","classList","contains","prev","next","prevSame","nextSame","topRadius","bottomRadius","style","borderTopRightRadius","borderBottomRightRadius","borderTopLeftRadius","borderBottomLeftRadius","marginBottom","parentElement","addEventListener","updateTextareaSize","e","key","toLowerCase","click","files","selectedFiles","push","sendMessage","userProfilePictures","img","onerror","display","src","trim","message","value","console","warn","currentTimestamp","Date","cleanedMessageText","window","ProfanityFilter","clean","sendToServer","authToken","senderId","userId","senderName","messageText","sentTime","recipientIds","createMessage","data","previous","messageContainer","createElement","add","msgDates","msgTime","formatUTCTo12Hour","timestamp","timestampText","textContent","appendChild","monthNumber","getUTCMonth","msgDate","msgDay","msgMonth","msgYear","getUTCDate","toLocaleString","weekday","timeZone","month","getFullYear","String","padStart","sender","profile","profileImage","profileSender","messageLabel","messageLabelText","remove","userIcon","className","id","profileColour","color","prevTime","parse","current","isSameDay","loadMessages","firstChild","messagesToLoad","arraysAreEqual","noMessages","messageElement","scrollTop","scrollHeight","clientHeight","utcTimestamp","toLocaleTimeString","hour","minute","hour12","scrollBottomBtn","updateScrollBottom","rootFontSize"],"version":3,"file":"public.7486c304.js.map"}